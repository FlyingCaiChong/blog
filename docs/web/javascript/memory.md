---
title: "JavaScript内存管理"
author: "菜虫"
date: "2023-01-31"
---

# JavaScript 内存管理

#### 认识内存管理

不管什么样的编程语言, 在代码的执行过程中都是需要给它分配内存的, 不同的是某些编程语言需要我们自己手动的管理内存, 某些编程语言会自动帮助我们管理内存.

不管以什么样的方式来管理内存, 内存的管理都会有如下的生命周期:

1.  分配申请你需要的内存(申请)
2.  使用分配的内存(存放一些东西,比如对象等)
3.  不需要使用时, 对其进行释放

不同的编程语言对于第一步和第三步会有不同的实现:

- 手动管理内存: 比如 `C`、`C++`、早期的 `OC`, 都需要手动来管理内存的申请和释放(`malloc` 和 `free` 函数);
- 自动管理内存: 比如 `Java`、`JavaScript`、`Python`、`Swift`、`Dart` 等, 它们会自动帮助我们管理内存;

`JavaScript` 通常情况下是不需要手动管理的

`JavaScript` 在**定义变量**的时候就自动分配内存了

内存分配方式:

1.  对于基本数据类型是在栈空间进行分配
2.  对于复杂数据类型是在堆内存中开辟一块空间,并且将这块空间的指针返回值变量引用

#### JS 的垃圾回收

因为内存的大小是有限的,所以当内存不再需要的时候,我们需要对其进行释放,以便腾出更多的内存空间
在手动管理内存的语言中,我们需要通过一些方式自己来释放不再需要的内存,比如 free 函数:

- 但是这种管理的方式其实非常的低效,影响我们编写逻辑代码的效率;
- 并且这种方式对开发者的要求也很高,并且一不小心就会产生内存泄露;

所以大部分现代的编程语言都是有自己的垃圾回收机制:

- 垃圾回收的英文是 `Garbage Collection`, 简称 `GC`;
- 对于那些不再使用的对象,我们都称之为垃圾,它需要被回收,以释放更多的内存空间;
- 而我们的语言运行环境,比如 `java` 的运行环境 `JVM`,`Javascript` 的运行环境 `js` 引擎都会内置垃圾回收器;
- 垃圾回收器我们也会简称为 `GC`;

#### 常见的 GC 的算法

- 引用计数
  - 当一个对象有一个引用指向它时,那么这个对象的引用就+1;当一个对象的引用为 0 时,这个对象就可以被销毁掉;
  - 这个算法有一个很大的弊端就是会产生循环引用;
- 标记清除

  - 这个算法是设置一个根对象(`root object`),垃圾回收器会定期从这个根开始,找所有从根开始有引用到的对象,对于哪些没有引用到的对象,就认为是不可用的对象;
  - 这个算法可以很好的解决循环引用的问题;

- JS 引擎比较广泛的采用的就是标记清除的算法
